<%- include('header') %>

<h4 class="mb-3">Kölcsönözhető tárgyak</h4>

<%- include('message') %>

<form action="/targyak" method="post">
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>#</th>
                <th>Cím</th>
                <th>Tipus</th>
                <th>Elérhető-e</th>
                <th>Műveletek</th>
            </tr>
        </thead>
        <tbody id="hely">
            <%
                total = 0;
                results.forEach((item, index) => { %>
                <tr>
                    <td><%= index+1 %>.</td>
                    <td><%= item.title %></td>
                    <td><%= item.type %></td>
                    <td><%= item.available %></td>
                    <td><a href="/delete/<%= item.id %>" class="btn btn-danger btn-sm">Töröl</a>
                </tr>
            <% 
                total += item.mennyiseg * item.nettoar
        }) %>
        
        </tbody>
        <tfoot>
            <tr>
                <td colspan="5" class="text-end">Összesen: <strong><%= total %></strong> db</td>
            </tr>
        </tfoot>
    </table>
</form>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        TablazatToltes();
    });

    function TablazatToltes() {
        fetch('http://localhost:3000/items/itemdatas')
            .then(response => response.json())
            .then(data => {
                let tbody = document.querySelector('#hely');
                data.forEach(steps => {
                    let tr = document.createElement('tr');
                    let td1 = document.createElement('td');
                    let td2 = document.createElement('td');
                    td1.innerHTML =  steps.date;
                    td2.innerHTML = steps.count;
                    tr.appendChild(td1);
                    tr.appendChild(td2);
                    tbody.appendChild(tr);
                });
            })
            .catch(error => console.error('Error fetching step data:', error));
    }
</script>

<%- include('footer') %>